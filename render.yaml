services:
  # バックエンド API (FastAPI)
  - type: web
    name: gym-backend
    runtime: docker
    region: singapore
    plan: free
    dockerfilePath: ./backend/Dockerfile.render
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: PORT
        value: "8000"

  # 定期実行ワーカー (Ingestion)
  - type: cron
    name: gym-ingestion-worker
    runtime: docker
    region: singapore
    plan: free
    schedule: "0 19 * * *" # 日本時間 朝4:00
    dockerfilePath: ./backend/Dockerfile.render
    startCommand: python -m scripts.ingest.run_nightly
    envVars:
      - key: DATABASE_URL
        sync: false

# データベース (PostgreSQL)
databases:
  - name: gym-postgres
    plan: free        # 無料プラン (30日で期限切れになる制限あり)
    region: singapore
    databaseName: gym_directory
    user: appuser