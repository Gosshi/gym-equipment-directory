# 検索ページネーション仕様

ジム検索系エンドポイントのページネーション仕様をまとめます。対象は `/gyms/search` と `/gyms/nearby` です。

## クエリパラメーター

- `page` : 1 始まりのページ番号。省略時は `1`。
- `page_size` : 1 ページあたりの件数。省略時は `20`。最小 `1`, 最大 `100`。
- 互換性のため `per_page` や `limit` を指定しても同じ値として扱われますが、新規実装では `page_size` を推奨します。

## レスポンス形式

両エンドポイントとも以下の形で返します。

```json
{
  "items": [...],
  "total": 123,
  "page": 1,
  "page_size": 20,
  "has_more": true,
  "has_prev": false,
  "page_token": null
}
```

- `total` は総件数です。取得コストが高いケースでは `null` になる場合があります。
- `has_more` が `false` の場合は次ページが存在しません。`has_prev` は 1 ページ目以外で `true` になります。
- `page_token` はレガシーな Keyset ページング互換用です。通常のページ番号利用では `null` です。

## フォールバック

古い API 実装が配列のみを返す場合でもフロントエンドは以下のように扱います。

- 受け取った配列の長さが `page_size` 未満であれば `has_more = false` とみなします。
- `total` は未知のため `null`、または取得した配列長を表示上の件数として利用します。

## `/gyms/nearby` の注意事項

- `total` は指定半径内に存在する件数です。
- `page` と `page_size` に基づくオフセットページングで取得します。以前の `page_token` による継続トークンも互換用に受け付けます。
- 不正な `page_token` が指定された場合は検証段階で 422 を返します（検索結果が 0 件でも同様）。

## 既定値のまとめ

| 項目        | 既定値  | 備考                 |
| ----------- | ------- | -------------------- |
| `page`      | 1       | 1 始まり             |
| `page_size` | 20      | 1..100 に制限        |
| `has_more`  | `false` | 末尾ページで `false` |
