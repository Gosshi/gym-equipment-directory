# Codex 向けプロンプト: PR-06 API スキーマ確定

以下の指示を Codex に与え、PR-06（公開 API スキーマ確定）を実装させる。日本語での説明だが、コード・識別子は既存スタイルに合わせて英語で記述すること。

## スコープ（PR-06）
- 公開 API（ジム検索、ジム詳細、メタデータ）の **リクエスト/レスポンススキーマを確定** する。
- **バリデーションとエラーハンドリングを統一** し、422/404 の返却を一貫させる。
- 確定したスキーマを反映した **OpenAPI ドキュメントを更新** する。

## 受入基準
- `/gyms/search`、`/gyms/{slug}`、およびメタ系エンドポイントが確定版スキーマで応答する。
- 不正パラメータは 422、存在しないジムは 404 を返し、エラーレスポンスの JSON 形状が揃っている。
- リポジトリ内の OpenAPI 生成物が更新され、変更が diff で確認できる。
- 上記エンドポイントの 200/422/404 をカバーする pytest が追加・更新されている。

## コードベースの位置
- バックエンド: `app/`
- ルーター: `app/api/routes/`
- Pydantic スキーマ: `app/api/schemas/`
- サービス/リポジトリ: `app/services/`, `app/repositories/`
- ページネーション: `app/api/dependencies/pagination.py` ほか関連ユーティリティ
- OpenAPI 生成: `openapitools.json` と既存の生成物（`docs/` 配下 または `payload.json`）

## 実装手順
1. **スキーマ定義の調整**
   - 検索レスポンスに `items`, `total`, `page`（または keyset cursor）, `has_more` を含める。
   - ジム詳細に画像、設備/設備詳細、`last_verified_at_cached` を含め、後方互換を保つ。
   - メタ API で都道府県・市区町村・カテゴリの安定キーとラベルを提供する。
2. **ルーターとバリデーション**
   - クエリ/パス/ボディのモデルで必須項目を検証し、妥当なデフォルトを設定する。
   - 無効入力は 422、存在しない slug は 404 を返す。
3. **エラーハンドリングの統一**
   - 上記エンドポイント群でステータスコードと JSON 形状を揃える。
4. **OpenAPI 更新**
   - 確定スキーマを反映するよう OpenAPI 生成物を更新する。
5. **テスト（pytest）**
   - `/gyms/search`、`/gyms/{slug}`、メタ API について 200/422/404 のケースと主要フィールドを検証するテストを追加/更新する。
6. **DB マイグレーション禁止**
   - この PR では DB スキーマ変更を行わない。

## 非機能ガイドライン
- Python 3.11 を前提に、行長は 100 文字以内、文字列はダブルクォートを使用。
- Ruff のフォーマット/チェックに従い、変更は PR-06 に必要な最小限に留める。
