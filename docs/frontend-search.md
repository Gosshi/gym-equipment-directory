# Frontend Search Distance Filter

このページではジム検索の「現在地＋半径」フィルタに関する仕様をまとめています。

## クエリパラメータ

- 緯度・経度を利用する検索は `lat`・`lng`・`radius_km` を URL に含めます。
- `radius_km` は現在地が設定されている場合は常に書き出され、共有リンクから半径が復元されます。
- 既存の `page` や `page_size` などのページネーション情報と同じく `useGymSearch` がシリアライズ／パースを担当します。

## デフォルトとフォールバック

- 初回マウント時にクエリに `lat` / `lng` が無い場合は `navigator.geolocation.getCurrentPosition` で現在地の取得を試みます。
- 権限拒否・タイムアウト・API 非対応などで位置情報を取得できなかった場合は東京駅周辺（35.681236, 139.767125）をデフォルト地点として利用します。
- フォールバック時でも UI には半径スライダーの値が保持され、URL も同じ値で更新されます。

## UI の挙動

- スライダーの変更は 300ms のデバウンス後に検索結果を再フェッチし、`page` を 1 にリセットします。
- 「現在地を再取得」ボタンは取得中にスピナーを表示し、失敗時は警告アイコンとトースト（「位置情報が許可されていません。任意の地点を選ぶか、許可してください。」など）を表示します。
- 「デフォルト地点を使用」ボタンでフォールバック地点を明示的に適用できます。手動入力や「位置情報をクリア」も可能です。
- スライダーには `aria-label` を付与し、現在の半径をラベル横に表示してアクセシビリティを確保しています。

## デバウンスとリクエスト

- 検索条件（キーワード・カテゴリ・距離など）の変更は `useGymSearch` が 300ms のデバウンスでクエリを更新します。
- 位置情報が設定されている場合は API に `radiusKm` として渡され、`/gyms/search` が `radius_km` を受け取ります。
- ページネーションは距離変更時にリセットされ、`loadNextPage` などの既存挙動も維持されます。

## 権限失敗時の通知

- 位置情報取得に失敗した場合は `location.status === "error"` になり、トースト／バナーでユーザーに許可を促します。
- フォールバック地点を利用してもエラーステータスを維持することで警告アイコンを表示し続けます。
