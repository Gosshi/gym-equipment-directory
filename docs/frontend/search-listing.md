# Gym Search Listing

フロントエンド側の /gyms ページで提供する検索・絞り込み機能の整理メモです。実装は
`src/hooks/useGymSearch.ts` と `src/features/gyms/GymsPage.tsx` を中心に構成しています。

## クエリパラメータ

| 名前         | 型     | 説明                                                         |
| ------------ | ------ | ------------------------------------------------------------ |
| `q`          | string | キーワード検索。空文字はパラメータから削除します。           |
| `prefecture` | string | 都道府県スラッグ。未指定時は削除。                           |
| `equipment`  | string | 設備カテゴリのスラッグをカンマ区切りで連結。複数選択に対応。 |
| `page`       | number | 1 始まりのページ番号。1 の場合は削除。                       |
| `per_page`   | number | 1 ページの表示件数。既定の 12 以外のみ保持。                 |

`useGymSearch` で URL ⇄ 内部状態を同期し、Next.js の `router.push` を使用して履歴を
積み上げています。既存の URL を共有すると同じ条件で一覧が復元されます。

## URL 同期と状態管理

- 文字入力とセレクト変更は 300ms のデバウンス後に URL を更新します。
- ページングと表示件数の変更は即時で URL へ反映します。
- URL 変更時はフォーム値・検索結果ともに自動で再評価されます。
- フィルタをリセットすると現在の `per_page` を維持したまま他の条件を初期化します。

## UI ステート

- **Loading**: 初回ロード時はスケルトンカードを表示。既存結果がある状態では
  `aria-busy` でローディングを表現します。
- **Empty**: 条件に一致しない場合は説明メッセージを表示します。
- **Error**: API エラー時は再試行ボタン付きのアラートを表示します。
- ページングの前後ボタンはローディング中や有効なページが無い時に無効化します。

## 今後の拡張候補

- 無限スクロールや仮想リストへの切り替え。
- 並び替え（スコア順・更新順など）の追加と UI への露出。
- 選択した設備カテゴリに応じたサジェストやタグ表示の強化。
- 都道府県選択時に対応する市区町村のサブフィルタ表示。
